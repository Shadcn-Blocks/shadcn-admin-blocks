import { Meta, Canvas } from '@storybook/addon-docs/blocks'
import * as Stories from './Layout.stories'

<Meta title="Layout" />

# Layout

A composable and flexible layout system for admin panels and dashboards. Use `LayoutBase` and individual building blocks for full control, or wrap `WorkspacesProvider` and `WorkspaceSwitch` to enable workspace switching.

---

## Installation

```bash
npx shadcn add https://raw.githubusercontent.com/Shadcn-Blocks/shadcn-admin-blocks/refs/heads/main/public/r/Layout.json
```

---

## Usage

### ðŸ§± Default Layout Without Organizations

By default, the `Layout` component does **not** include an organization switcher on its own. It renders the sidebar header and footer based solely on the provided `sidebar` configuration:

```tsx
<Layout
  sidebar={{
    header: {
      title: 'Dashboard',
      subtitle: 'Welcome back!',
      icon: <HouseIcon />,
    },
    footer: {
      signOut: () => alert('logging out'),
      user: {
        avatar: 'https://cat-avatars.vercel.app/api/cat?name=John%20Doe',
        email: 'john.doe@example.com',
        name: 'John Doe',
      },
    },
  }}
>
  I am content
</Layout>
```

<Canvas of={Stories.Default} />

---

## Loading Workspaces

To populate the switcher, you need to fetch or define your workspace/organization data and initialize the context. Typically you:

1. Wrap your app in `<WorkspacesProvider>`.
2. Call `initializeWorkspaces()` with your fetched array of `{ name, logo, plan }`.

Example:

```tsx
import { WorkspacesProvider, useWorkspaces, Workspace } from '@/contexts/WorkspacesContext'

const App: React.FC = () => {
  return (
    <WorkspacesProvider>
      <Initializer />
      <LayoutBase>
        <LayoutSidebar>...</LayoutSidebar>
      </LayoutBase>
    </WorkspacesProvider>
  )
}

const Initializer: React.FC = () => {
  const { initializeWorkspaces } = useWorkspaces()

  React.useEffect(() => {
    async function load() {
      const resp = await fetch('/api/workspaces')
      const data: Workspace[] = await resp.json()
      initializeWorkspaces(data)
    }
    load()
  }, [initializeWorkspaces])

  return null
}
```

---

### ðŸ”§ Layout With Workspace Switcher

To add workspace/organization switching, wrap the layout with `WorkspacesProvider` and insert `<WorkspaceSwitch />` in the sidebar header:

```tsx
<WorkspacesProvider>
  <LayoutBase>
    <LayoutSidebar>
      <LayoutSidebarHeader>
        <WorkspaceSwitch />
      </LayoutSidebarHeader>
      <LayoutSidebarContent>
        {/* Bottom Menu Items */}
        <SidebarMenuItem>
          <SidebarMenuButton asChild>
            <Link to="/">
              <LifeBuoy />
              Support
            </Link>
          </SidebarMenuButton>
        </SidebarMenuItem>
        <SidebarMenuItem>
          <SidebarMenuButton asChild>
            <Link to="/">
              <Send />
              Feedback
            </Link>
          </SidebarMenuButton>
        </SidebarMenuItem>
      </LayoutSidebarContent>
      <LayoutSidebarFooter
        user={{
          name: 'Hello world',
          email: 'hello@example.com',
          avatar: 'https://cat-avatars.vercel.app/api/cat?name=Hello%20World',
        }}
      >
        <DropdownMenuGroup>
          <DropdownMenuItem asChild>
            <Link to="/">
              <Sparkles />
              Upgrade to Pro
            </Link>
          </DropdownMenuItem>
        </DropdownMenuGroup>
        <DropdownMenuSeparator />
        <DropdownMenuGroup>
          <DropdownMenuItem asChild>
            <Link to="/">
              <BadgeCheck />
              Account
            </Link>
          </DropdownMenuItem>
          <DropdownMenuItem asChild>
            <Link to="/">
              <CreditCard />
              Billing
            </Link>
          </DropdownMenuItem>
          <DropdownMenuItem asChild>
            <Link to="/">
              <Bell />
              Notifications
            </Link>
          </DropdownMenuItem>
        </DropdownMenuGroup>
      </LayoutSidebarFooter>
    </LayoutSidebar>
    <SidebarInset>
      <LayoutHeader />
      <LayoutContent>I am content</LayoutContent>
    </SidebarInset>
  </LayoutBase>
</WorkspacesProvider>
```

<Canvas of={Stories.Customized} />
