import { Meta, Canvas } from '@storybook/blocks'
import * as Stories from './Layout.stories'

<Meta title="Layout" />

# Layout

A composable and flexible layout system for admin panels and dashboards. Use `LayoutBase` and individual building blocks for full control, or wrap `WorkspacesProvider` and include `WorkspaceSwitch` to enable workspace switching.

---

## Installation

```bash
npx shadcn add https://raw.githubusercontent.com/Shadcn-Blocks/shadcn-admin-blocks/refs/heads/main/public/r/Layout.json
```

---

## Usage

### ðŸ§± Default Layout Without Workspace Switcher

By default, the `Layout` component does **not** include an organization or workspace switcher on its own. It renders the sidebar header and footer based solely on the provided `sidebar` configuration:

```tsx
<Layout
  sidebar={{
    header: {
      title: 'Dashboard',
      subtitle: 'Welcome back!',
      icon: <HouseIcon />,
    },
    footer: {
      signOut: () => alert('logging out'),
      user: {
        avatar: 'https://cat-avatars.vercel.app/api/cat?name=John%20Doe',
        email: 'john.doe@example.com',
        name: 'John Doe',
      },
    },
  }}
>
  I am content
</Layout>
```

<Canvas of={Stories.SimpleLayout} />

---

### ðŸ”§ Layout With Workspace Switcher

To add workspace switching into your sidebar, simply include `<WorkspaceSwitch />` inside your sidebar header. Your provider will already have the data from `initialWorkspaces`:

```tsx

const workspacesData: Workspace[] = [
  { id: 'acme-inc', name: 'Acme Inc', logo: LifeBuoy, plan: 'Enterprise' },
  { id: 'beta-co', name: 'Beta Co', logo: Send, plan: 'Pro' },
]

<WorkspacesProvider workspaces={workspacesData}>
  <LayoutBase>
    <LayoutSidebar>
      <LayoutSidebarHeader>
        <WorkspaceSwitch />
      </LayoutSidebarHeader>
      <LayoutSidebarContent>{/* bottom menu items */}</LayoutSidebarContent>
      <LayoutSidebarFooter user={user}>/* footer controls */</LayoutSidebarFooter>
    </LayoutSidebar>

    <SidebarInset>
      <LayoutHeader />
      <LayoutContent>I am content</LayoutContent>
    </SidebarInset>
  </LayoutBase>
</WorkspacesProvider>
```

<Canvas of={Stories.AdvancedLayout} />

---

### ðŸš€ Dynamic Routing Support

The layout system automatically supports dynamic routing parameters for multi-tenant or workspace-based applications through TanStack Router's `useParams` hook. No manual configuration needed:

#### Automatic Parameter Extraction

```tsx
<Layout
  sidebar={{
    header: {
      title: 'Multi-Tenant App',
      subtitle: 'Workspace: Acme Corp',
      icon: <HouseIcon />,
    },
    footer: {
      signOut: () => alert('logging out'),
      user: {
        avatar: 'https://cat-avatars.vercel.app/api/cat?name=John%20Doe',
        email: 'john.doe@example.com',
        name: 'John Doe',
      },
    },
  }}
>
  I am content
</Layout>
```

This automatically handles URLs like:
- `/workspace/$workspaceId/dashboard`
- `/tenant/$tenantId/users`
- `/organization/$orgId/settings`

The sidebar automatically:
- Extracts parameters from the current route using `useParams`
- Applies them to all navigation links
- Handles pattern matching for active states
- Maintains consistency across navigation

<Canvas of={Stories.DynamicRoutingLayout} />

---

## API Reference

### Layout

The main `Layout` component accepts a `sidebar` prop with the following structure:

```tsx
interface LayoutProps {
  sidebar?: {
    header?: LayoutSidebarHeaderProps
    footer?: LayoutSidebarFooterProps
  }
}
```

#### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `sidebar` | `object` | - | Sidebar configuration including header and footer |
| `children` | `ReactNode` | - | Main content to render |

#### Sidebar Configuration

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `header` | `LayoutSidebarHeaderProps` | - | Sidebar header configuration |
| `footer` | `LayoutSidebarFooterProps` | - | Sidebar footer configuration |

### LayoutSidebarContent

The `LayoutSidebarContent` component automatically handles dynamic routing:

```tsx
interface LayoutSidebarContentProps extends PropsWithChildren {
  // No manual params needed - automatically extracted from route
}
```

#### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `children` | `ReactNode` | - | Additional sidebar content (secondary actions, etc.) |

#### Usage

The component automatically extracts parameters from the current route:

```tsx
// No configuration needed - just use it
<LayoutSidebarContent />
```

---

## Route Configuration

To use dynamic routing with the layout system, configure your routes with the appropriate static data:

```tsx
// In your route configuration
{
  path: '/workspace/$workspaceId/dashboard',
  staticData: {
    title: 'Dashboard',
    icon: <DashboardIcon />,
    showInSidebar: true,
    sidebarOrder: 1
  }
}
```

The sidebar will automatically:
- Generate navigation items from routes with `showInSidebar: true`
- Extract and apply dynamic parameters from the current route
- Maintain active state for current route
- Support nested/collapsible navigation structure