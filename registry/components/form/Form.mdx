import { Meta, Canvas } from '@storybook/addon-docs/blocks'
import * as FormFieldInputStories from './FormFieldInput.stories'
import * as FormFieldTextareaStories from './FormFieldTextarea.stories'
import * as FormFieldSelectStories from './FormFieldSelect.stories'
import * as FormFieldCheckboxStories from './FormFieldCheckbox.stories'
import * as FormFieldDatePickerStories from './FormFieldDatePicker.stories'

<Meta title="Form" />

# Form Components

Enhanced form field components that wrap the entire shadcn/ui FormField pattern into single, easy-to-use components. These components dramatically reduce boilerplate while maintaining full compatibility with React Hook Form and shadcn/ui.

## Overview

### Complete FormField Components
- **FormFieldInput** - Complete input field with label, description, and validation
- **FormFieldTextarea** - Complete textarea field with label, description, and validation
- **FormFieldSelect** - Complete select field with label, description, and validation
- **FormFieldCheckbox** - Complete checkbox field with label, description, and validation
- **FormFieldDatePicker** - Complete date picker field with label, description, and validation

### Utility Components
- **Form** - Enhanced form wrapper with automatic loading states and schema support
- **FormSubmitButton** - Smart submit button with automatic loading states
- **FormFieldWrapper** - Base wrapper for creating custom form fields
- **FormDatePicker** - Standalone date picker with calendar functionality

## Installation

```bash
npx shadcn add https://raw.githubusercontent.com/Shadcn-Blocks/shadcn-admin-blocks/refs/heads/main/public/r/Form.json
```

## Quick Comparison

### Before (Traditional shadcn/ui pattern):
```tsx
<FormField
  control={form.control}
  name="username"
  render={({ field }) => (
    <FormItem>
      <FormLabel>Username</FormLabel>
      <FormControl>
        <Input placeholder="Enter username" {...field} />
      </FormControl>
      <FormDescription>This is your public display name.</FormDescription>
      <FormMessage />
    </FormItem>
  )}
/>
```

### After (With FormFieldInput):
```tsx
<FormFieldInput
  name="username"
  label="Username"
  placeholder="Enter username"
  description="This is your public display name."
/>
```

## Basic Usage

### FormFieldInput

Complete input field with built-in FormField structure:

<Canvas of={FormFieldInputStories.Basic} />

```tsx
import { FormFieldInput } from '@/components/form'
import { Form } from '@/components/ui/form'

// Simple usage
<FormFieldInput
  name="username"
  label="Username"
  placeholder="Enter your username"
  description="This is your public display name."
/>

// With all input props
<FormFieldInput
  name="email"
  label="Email Address"
  type="email"
  placeholder="your.email@example.com"
  description="We'll never share your email."
  autoComplete="email"
/>
```

#### Input Types

<Canvas of={FormFieldInputStories.EmailType} />
<Canvas of={FormFieldInputStories.PasswordType} />

### FormFieldTextarea

Complete textarea field with built-in FormField structure:

<Canvas of={FormFieldTextareaStories.Basic} />

```tsx
import { FormFieldTextarea } from '@/components/form'

<FormFieldTextarea
  name="bio"
  label="Biography"
  placeholder="Tell us about yourself..."
  rows={4}
  description="Optional - maximum 500 characters."
/>
```

#### Custom Rows

<Canvas of={FormFieldTextareaStories.CustomRows} />

### FormFieldSelect

Complete select field with built-in FormField structure:

<Canvas of={FormFieldSelectStories.Basic} />

```tsx
import { FormFieldSelect, SelectItem } from '@/components/form'

<FormFieldSelect
  name="country"
  label="Country"
  placeholder="Select a country"
  description="Select your country of residence."
>
  <SelectItem value="us">United States</SelectItem>
  <SelectItem value="ca">Canada</SelectItem>
  <SelectItem value="uk">United Kingdom</SelectItem>
</FormFieldSelect>
```

#### With Groups

<Canvas of={FormFieldSelectStories.WithGroups} />

### FormFieldCheckbox

Complete checkbox field with built-in FormField structure:

<Canvas of={FormFieldCheckboxStories.Basic} />

```tsx
import { FormFieldCheckbox } from '@/components/form'

// With children (recommended)
<FormFieldCheckbox name="terms">
  I agree to the terms and conditions
</FormFieldCheckbox>

// With label prop
<FormFieldCheckbox
  name="newsletter"
  label="Subscribe to newsletter"
  description="Receive updates about new features."
/>
```

#### With Description

<Canvas of={FormFieldCheckboxStories.WithDescription} />

### FormFieldDatePicker

Complete date picker field with built-in FormField structure:

<Canvas of={FormFieldDatePickerStories.Basic} />

```tsx
import { FormFieldDatePicker } from '@/components/form'

<FormFieldDatePicker
  name="birthDate"
  label="Birth Date"
  placeholder="Select your birth date"
  description="Must be 18 years or older."
  max={new Date()} // No future dates
/>
```

#### With Date Constraints

<Canvas of={FormFieldDatePickerStories.WithMinDate} />

## Enhanced Form Component

The `Form` component provides a significantly simplified way to create forms with automatic loading states and schema validation:

### Ultra-Simple Schema-Based Forms

```tsx
import { z } from 'zod'
import { Form, FormSubmitButton, FormFieldInput } from '@/components/form'

const userSchema = z.object({
  name: z.string().min(2, 'Name must be at least 2 characters'),
  email: z.string().email('Please enter a valid email'),
})

export function SimpleForm() {
  const onSubmit = async (data) => {
    // Form automatically shows loading state
    await api.createUser(data)
    alert('User created!')
  }

  return (
    <Form schema={userSchema} onSubmit={onSubmit} className="space-y-4">
      <FormFieldInput
        name="name"
        label="Full Name"
        placeholder="Enter your name"
      />
      
      <FormFieldInput
        name="email"
        label="Email"
        type="email"
        placeholder="your@email.com"
      />
      
      {/* Button automatically shows loading state during submission */}
      <FormSubmitButton>Create User</FormSubmitButton>
    </Form>
  )
}
```

### Benefits of the Form Component

- **No useForm boilerplate** - Form creates and manages the form instance internally
- **No zodResolver imports** - Form handles Zod schema resolution automatically
- **Automatic loading states** - Submit buttons show loading during async operations
- **Type safety** - Full TypeScript inference from Zod schema
- **Backward compatible** - Still works with existing form instances

### Form Component API

```tsx
// Schema-based usage (recommended)
<Form
  schema={zodSchema}                    // Zod schema for validation
  defaultValues={{ name: '' }}         // Optional default values
  onSubmit={async (data) => {}}         // Async submit handler
  className="space-y-4"                 // Optional styling
>
  {/* Form fields */}
</Form>

// Traditional usage with existing form instance
<Form
  form={form}                           // Existing useForm instance
  onSubmit={async (data) => {}}         // Async submit handler
>
  {/* Form fields */}
</Form>
```

### FormSubmitButton

Smart button that automatically handles loading states:

```tsx
import { FormSubmitButton } from '@/components/form'

// Basic usage - shows "Submitting..." with spinner
<FormSubmitButton>Submit</FormSubmitButton>

// Custom loading text
<FormSubmitButton loadingText="Creating account...">
  Create Account
</FormSubmitButton>

// Without loading icon
<FormSubmitButton showLoadingIcon={false} loadingText="Saving...">
  Save Draft
</FormSubmitButton>

// All Button props supported
<FormSubmitButton variant="destructive" className="w-full">
  Delete Account
</FormSubmitButton>
```

## Complete Form Example

Here's a complete form using all the enhanced FormField components:

```tsx
import { z } from 'zod'
import {
  Form,
  FormSubmitButton,
  FormFieldInput,
  FormFieldTextarea,
  FormFieldSelect,
  FormFieldCheckbox,
  FormFieldDatePicker,
  SelectItem,
} from '@/components/form'

const formSchema = z.object({
  firstName: z.string().min(2, 'First name must be at least 2 characters'),
  lastName: z.string().min(2, 'Last name must be at least 2 characters'),
  email: z.string().email('Please enter a valid email'),
  bio: z.string().max(500, 'Bio must be less than 500 characters').optional(),
  country: z.string().min(1, 'Please select a country'),
  birthDate: z.date({
    required_error: 'Please select your birth date',
  }),
  newsletter: z.boolean().default(false),
  terms: z.boolean().refine((val) => val === true, 'You must accept the terms'),
})

export function RegistrationForm() {
  const onSubmit = async (data) => {
    console.log('Form submitted:', data)
    // Simulate API call
    await new Promise(resolve => setTimeout(resolve, 2000))
    alert('Registration successful!')
  }

  return (
    <Form 
      schema={formSchema}
      defaultValues={{ newsletter: false }}
      onSubmit={onSubmit} 
      className="space-y-6 max-w-2xl"
    >
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <FormFieldInput
            name="firstName"
            label="First Name"
            placeholder="Enter your first name"
            description="Your first name as it appears on official documents."
          />

          <FormFieldInput
            name="lastName"
            label="Last Name"
            placeholder="Enter your last name"
          />
        </div>

        <FormFieldInput
          name="email"
          label="Email Address"
          type="email"
          placeholder="your.email@example.com"
          description="We'll never share your email with anyone else."
        />

        <FormFieldTextarea
          name="bio"
          label="Biography"
          placeholder="Tell us about yourself..."
          rows={4}
          description="Optional - maximum 500 characters."
        />

        <FormFieldSelect
          name="country"
          label="Country"
          placeholder="Select your country"
          description="Select your country of residence."
        >
          <SelectItem value="us">United States</SelectItem>
          <SelectItem value="ca">Canada</SelectItem>
          <SelectItem value="uk">United Kingdom</SelectItem>
          <SelectItem value="de">Germany</SelectItem>
          <SelectItem value="fr">France</SelectItem>
        </FormFieldSelect>

        <FormFieldDatePicker
          name="birthDate"
          label="Birth Date"
          placeholder="Select your birth date"
          description="You must be 18 years or older."
          max={new Date()}
        />

        <div className="space-y-4">
          <FormFieldCheckbox name="newsletter">
            Subscribe to our newsletter for updates and tips
          </FormFieldCheckbox>

          <FormFieldCheckbox name="terms">
            I agree to the{' '}
            <a href="#" className="text-primary underline">
              Terms of Service
            </a>{' '}
            and{' '}
            <a href="#" className="text-primary underline">
              Privacy Policy
            </a>
          </FormFieldCheckbox>
        </div>

        <div className="flex justify-end gap-2">
          <FormSubmitButton>Register</FormSubmitButton>
        </div>
    </Form>
  )
}
```

## Component Props

### FormFieldInput

```tsx
interface FormFieldInputProps {
  name: string                    // Field name for form registration
  label?: string                  // Field label text
  description?: string            // Helper text below the field
  // Plus all native input props (type, placeholder, disabled, etc.)
}
```

### FormFieldTextarea

```tsx
interface FormFieldTextareaProps {
  name: string                    // Field name for form registration
  label?: string                  // Field label text
  description?: string            // Helper text below the field
  // Plus all native textarea props (rows, placeholder, disabled, etc.)
}
```

### FormFieldSelect

```tsx
interface FormFieldSelectProps {
  name: string                    // Field name for form registration
  label?: string                  // Field label text
  description?: string            // Helper text below the field
  placeholder?: string            // Placeholder text for select trigger
  children: React.ReactNode       // SelectItem components
  disabled?: boolean              // Disable the select
}
```

### FormFieldCheckbox

```tsx
interface FormFieldCheckboxProps {
  name: string                    // Field name for form registration
  label?: string                  // Field label text (alternative to children)
  description?: string            // Helper text below the checkbox
  children?: React.ReactNode      // Checkbox label content (preferred over label prop)
  disabled?: boolean              // Disable the checkbox
}
```

### FormFieldDatePicker

```tsx
interface FormFieldDatePickerProps {
  name: string                    // Field name for form registration
  label?: string                  // Field label text
  description?: string            // Helper text below the field
  placeholder?: string            // Placeholder text for date button
  dateFormat?: string             // Date format (default: "PPP")
  min?: Date                      // Minimum selectable date
  max?: Date                      // Maximum selectable date
  disabled?: boolean              // Disable the date picker
}
```

## Advanced Usage

### Custom Validation

All components work seamlessly with React Hook Form validation:

```tsx
const schema = z.object({
  username: z.string()
    .min(3, 'Username must be at least 3 characters')
    .regex(/^[a-zA-Z0-9_]+$/, 'Username can only contain letters, numbers, and underscores'),
  
  age: z.string()
    .transform((val) => parseInt(val, 10))
    .pipe(z.number().min(18, 'Must be at least 18 years old')),
  
  website: z.string()
    .url('Must be a valid URL')
    .optional()
    .or(z.literal('')),
})
```

### Conditional Fields

```tsx
const watchCountry = form.watch('country')

return (
  <>
    <FormFieldSelect name="country" label="Country">
      <SelectItem value="us">United States</SelectItem>
      <SelectItem value="ca">Canada</SelectItem>
    </FormFieldSelect>

    {watchCountry === 'us' && (
      <FormFieldInput
        name="state"
        label="State"
        placeholder="Enter your state"
      />
    )}
  </>
)
```

### Dynamic Form Arrays

```tsx
const { fields, append, remove } = useFieldArray({
  control: form.control,
  name: 'emails',
})

return (
  <>
    {fields.map((field, index) => (
      <div key={field.id} className="flex gap-2">
        <FormFieldInput
          name={`emails.${index}.value`}
          label={index === 0 ? 'Email Addresses' : undefined}
          type="email"
          placeholder="Enter email address"
        />
        <Button
          type="button"
          variant="ghost"
          size="icon"
          onClick={() => remove(index)}
        >
          <X className="h-4 w-4" />
        </Button>
      </div>
    ))}
    <Button
      type="button"
      variant="outline"
      size="sm"
      onClick={() => append({ value: '' })}
    >
      Add Email
    </Button>
  </>
)
```

## Accessibility

All FormField components include comprehensive accessibility features:

- Automatic `aria-describedby` linking for descriptions and errors
- Proper label association
- Error announcements
- Keyboard navigation support
- Focus management
- ARIA attributes for screen readers

## TypeScript Support

All components are fully typed with TypeScript:

```tsx
// Type-safe form data
type FormData = {
  username: string
  email: string
  age: number
  country: string
  birthDate: Date
  newsletter: boolean
}

// Components automatically infer types from form schema
const form = useForm<FormData>()

// TypeScript will enforce correct field names
<FormFieldInput name="username" />  // ✅ Valid
<FormFieldInput name="userName" />  // ❌ Type error
```

## Migration Guide

### From shadcn/ui FormField pattern:

```tsx
// Before
<FormField
  control={form.control}
  name="email"
  render={({ field }) => (
    <FormItem>
      <FormLabel>Email</FormLabel>
      <FormControl>
        <Input type="email" placeholder="Email" {...field} />
      </FormControl>
      <FormDescription>Your email address.</FormDescription>
      <FormMessage />
    </FormItem>
  )}
/>

// After
<FormFieldInput
  name="email"
  label="Email"
  type="email"
  placeholder="Email"
  description="Your email address."
/>
```

### From custom form implementations:

1. Install the form components
2. Replace your custom form fields with the appropriate FormField components
3. Remove boilerplate code
4. Enjoy cleaner, more maintainable forms!

## Best Practices

1. **Use FormField components for all form inputs** - They handle all the boilerplate
2. **Always provide labels** - Either via `label` prop or `children` (for checkbox)
3. **Add helpful descriptions** - Use the `description` prop for user guidance
4. **Leverage TypeScript** - Let it catch field name typos and type mismatches
5. **Handle loading states** - Disable fields during form submission

```tsx
<FormFieldInput
  name="email"
  label="Email"
  disabled={form.formState.isSubmitting}
/>
```

## Styling

Components inherit all shadcn/ui styling and can be customized:

```tsx
// Custom className
<FormFieldInput
  name="username"
  label="Username"
  className="bg-muted"
/>

// Custom form item styling
<div className="bg-card p-4 rounded-lg border">
  <FormFieldInput
    name="username"
    label="Username"
  />
</div>
```

## Conclusion

The enhanced FormField components provide a powerful, type-safe way to build forms with minimal boilerplate. They maintain full compatibility with React Hook Form and shadcn/ui while dramatically improving developer experience.